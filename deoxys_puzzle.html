<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ã‚ªã‚­ã‚·ã‚¹çŸ³ã‚®ãƒŸãƒƒã‚¯</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #000;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
        }
        
        #gameBoard {
            display: grid;
            grid-template-columns: repeat(11, 40px);  /* 11åˆ— */
            grid-template-rows: repeat(9, 40px);      /* 9è¡Œ */
            gap: 1px;
            background-color: #333;
            padding: 10px;
            margin: 20px 0;
        }
        
        .cell {
            width: 40px;
            height: 40px;
            background-color: #65A997;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
        }
        
        .cell.special {
            background-color: #9DCCC1;
        }
        
        .player {
            color: #0ff;
        }
        
        .stone {
            color: #f00;
        }
        
        #info {
            text-align: center;
            margin: 10px 0;
        }
        
        #controls {
            text-align: center;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .status {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h1>ãƒ‡ã‚ªã‚­ã‚·ã‚¹çŸ³ã‚®ãƒŸãƒƒã‚¯</h1>
    
    <div id="info">
        <div class="status">çŠ¶æ…‹: <span id="status">â–²ã‚’ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§èª¿ã¹ã¦ã¿ã‚ˆã†</span></div>
    </div>
    
    <div id="gameBoard"></div>
    
    <div id="controls">
        åå­—ã‚­ãƒ¼: ç§»å‹• | ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒˆ
    </div>

    <script>
        class DeoxysGame {
            constructor() {
                this.boardRows = 9;    // xåº§æ¨™ï¼ˆè¡Œï¼‰
                this.boardCols = 11;   // yåº§æ¨™ï¼ˆåˆ—ï¼‰
                this.playerX = 6;      // è¡Œ
                this.playerY = 5;      // åˆ—
                
                // çŸ³ã®é…ç½®ãƒ‡ãƒ¼ã‚¿
                this.stonePositions = [
                    [5, 5], [7, 1], [1, 5], [7, 9], [4, 2], 
                    [4, 8], [7, 5], [7, 1], [7, 9], [8, 5], [3, 5]
                ];
                
                // æ­©æ•°åˆ¶é™
                this.stepLimits = [4, 8, 8, 8, 4, 4, 4, 6, 3, 3];
                
                this.currentStage = 0;
                this.stepsRemaining = null; // æœ€åˆã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒˆã«ã¯æ­©æ•°åˆ¶é™ãªã—
                this.gameCleared = false;
                
                this.initBoard();
                this.setupEventListeners();
                this.updateDisplay();
            }
            
            initBoard() {
                const board = document.getElementById('gameBoard');
                board.innerHTML = '';
                
                // ç‰¹åˆ¥ãªãƒã‚¹ã®åº§æ¨™ã‚’å®šç¾©
                const specialCells = new Set();
                
                // (0, 5)
                specialCells.add('0,5');
                
                // (1, 4) ~ (1, 6)
                for (let y = 4; y <= 6; y++) {
                    specialCells.add(`1,${y}`);
                }
                
                // (2, 3) ~ (2, 7)
                for (let y = 3; y <= 7; y++) {
                    specialCells.add(`2,${y}`);
                }
                
                // (3, 3) ~ (3, 7)
                for (let y = 3; y <= 7; y++) {
                    specialCells.add(`3,${y}`);
                }
                
                // (4, 2) ~ (4, 8)
                for (let y = 2; y <= 8; y++) {
                    specialCells.add(`4,${y}`);
                }
                
                // (5, 1) ~ (5, 9)
                for (let y = 1; y <= 9; y++) {
                    specialCells.add(`5,${y}`);
                }
                
                // (6, 1) ~ (6, 9)
                for (let y = 1; y <= 9; y++) {
                    specialCells.add(`6,${y}`);
                }
                
                // (7, 0) ~ (7, 10)
                for (let y = 0; y <= 10; y++) {
                    specialCells.add(`7,${y}`);
                }
                
                for (let x = 0; x < this.boardRows; x++) {      // è¡Œ
                    for (let y = 0; y < this.boardCols; y++) {  // åˆ—
                        const cell = document.createElement('div');
                        cell.className = 'cell';
                        cell.id = `cell-${x}-${y}`;
                        
                        // ç‰¹åˆ¥ãªãƒã‚¹ã‹ãƒã‚§ãƒƒã‚¯
                        if (specialCells.has(`${x},${y}`)) {
                            cell.classList.add('special');
                        }
                        
                        board.appendChild(cell);
                    }
                }
            }
            
            setupEventListeners() {
                document.addEventListener('keydown', (e) => {
                    if (this.gameCleared) return;
                    
                    switch(e.key) {
                        case 'ArrowUp':
                            e.preventDefault();
                            this.movePlayer(-1, 0);  // ä¸Šã«ç§»å‹•ï¼ˆxåº§æ¨™ã‚’æ¸›ã‚‰ã™ï¼‰
                            break;
                        case 'ArrowDown':
                            e.preventDefault();
                            this.movePlayer(1, 0);   // ä¸‹ã«ç§»å‹•ï¼ˆxåº§æ¨™ã‚’å¢—ã‚„ã™ï¼‰
                            break;
                        case 'ArrowLeft':
                            e.preventDefault();
                            this.movePlayer(0, -1);  // å·¦ã«ç§»å‹•ï¼ˆyåº§æ¨™ã‚’æ¸›ã‚‰ã™ï¼‰
                            break;
                        case 'ArrowRight':
                            e.preventDefault();
                            this.movePlayer(0, 1);   // å³ã«ç§»å‹•ï¼ˆyåº§æ¨™ã‚’å¢—ã‚„ã™ï¼‰
                            break;
                        case ' ':
                            e.preventDefault();
                            this.interact();
                            break;
                    }
                });
            }
            
            movePlayer(dx, dy) {
                const newX = this.playerX + dx;
                const newY = this.playerY + dy;
                
                // å¢ƒç•Œãƒã‚§ãƒƒã‚¯
                if (newX < 0 || newX >= this.boardRows || newY < 0 || newY >= this.boardCols) {
                    return;
                }
                
                // çŸ³ã¨ã®è¡çªãƒã‚§ãƒƒã‚¯
                const [stoneX, stoneY] = this.stonePositions[this.currentStage];
                if (newX === stoneX && newY === stoneY) {
                    return;
                }
                
                this.playerX = newX;
                this.playerY = newY;
                
                // æ­©æ•°åˆ¶é™ãŒã‚ã‚‹å ´åˆã®ã¿æ­©æ•°ã‚’æ¸›ã‚‰ã™
                if (this.stepsRemaining !== null) {
                    this.stepsRemaining--;
                }
                
                this.updateDisplay();
            }
            
            interact() {
                const [stoneX, stoneY] = this.stonePositions[this.currentStage];
                const distance = Math.abs(this.playerX - stoneX) + Math.abs(this.playerY - stoneY);
                
                // çŸ³ã®éš£æ¥ãƒã‚§ãƒƒã‚¯ï¼ˆä¸Šä¸‹å·¦å³1ãƒã‚¹ä»¥å†…ï¼‰
                if (distance !== 1) {
                    return;
                }
                
                // æ­©æ•°åˆ¶é™ãƒã‚§ãƒƒã‚¯ï¼ˆæœ€åˆã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒˆä»¥å¤–ï¼‰
                if (this.stepsRemaining !== null && this.stepsRemaining < 0) {
                    this.resetStage();
                    return;
                }
                
                // æ¬¡ã®æ®µéšã¸
                this.currentStage++;
                
                if (this.currentStage >= 11) {
                    this.gameCleared = true;
                    document.getElementById('status').textContent = 'ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢ï¼ãƒ‡ã‚ªã‚­ã‚·ã‚¹å‡ºç¾ï¼';
                } else {
                    // 2å›ç›®ä»¥é™ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒˆã«ã¯æ­©æ•°åˆ¶é™ã‚’è¨­å®š
                    this.stepsRemaining = this.stepLimits[this.currentStage - 1];
                }
                
                this.updateDisplay();
            }
            
            resetStage() {
                this.currentStage = 0;
                this.stepsRemaining = null; // æœ€åˆã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒˆã«ã¯æ­©æ•°åˆ¶é™ãªã—
                document.getElementById('status').textContent = 'æ­©æ•°åˆ¶é™ï¼æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—';
                this.updateDisplay();
            }
            
            getStoneColor() {
                if (this.gameCleared) return '#ff0000';
                
                // æ®µéšã«å¿œã˜ã¦é»’ã‹ã‚‰èµ¤ã¸
                const intensity = Math.floor((this.currentStage / 10) * 255);
                return `rgb(${intensity}, 0, 0)`;
            }
            
            updateDisplay() {
                // å…¨ã‚»ãƒ«ã‚’ã‚¯ãƒªã‚¢
                for (let x = 0; x < this.boardRows; x++) {      // è¡Œ
                    for (let y = 0; y < this.boardCols; y++) {  // åˆ—
                        const cell = document.getElementById(`cell-${x}-${y}`);
                        cell.textContent = '';
                        // èƒŒæ™¯è‰²ã¯ãã®ã¾ã¾ç¶­æŒï¼ˆspecialã‚¯ãƒ©ã‚¹ã¯ä¿æŒï¼‰
                    }
                }
                
                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¡¨ç¤º
                const playerCell = document.getElementById(`cell-${this.playerX}-${this.playerY}`);
                playerCell.textContent = 'â—‹';
                playerCell.classList.add('player');
                
                // çŸ³ã‚’è¡¨ç¤º
                if (!this.gameCleared) {
                    const [stoneX, stoneY] = this.stonePositions[this.currentStage];
                    const stoneCell = document.getElementById(`cell-${stoneX}-${stoneY}`);
                    stoneCell.textContent = 'â–²';
                    stoneCell.style.color = this.getStoneColor();
                } else {
                    // ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢å¾Œã¯ãƒ‡ã‚ªã‚­ã‚·ã‚¹ã‚’è¡¨ç¤º
                    const deoxysCell = document.getElementById('cell-3-5');
                    deoxysCell.textContent = 'ğŸ‘¾';
                    deoxysCell.style.color = '#ff0000';
                }
                
                // UIæ›´æ–°
                if (!this.gameCleared && this.currentStage < 11) {
                    document.getElementById('status').textContent = 'â–²ã‚’ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§èª¿ã¹ã¦ã¿ã‚ˆã†';
                }
            }
        }
        
        // ã‚²ãƒ¼ãƒ é–‹å§‹
        const game = new DeoxysGame();
    </script>
</body>
</html>